<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Globus Music Hall - –ú–µ–Ω—é</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel+Decorative:wght@700;900&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1a1a1a 0%, #2c1810 50%, #1a1a1a 100%);
            color: #f5f5f5;
            line-height: 1.6;
            min-height: 100vh;
            padding: 20px 10px;
        }

        .container {
            max-width: 400px;
            margin: 0 auto;
            background: rgba(0, 0, 0, 0.7);
            border-radius: 20px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 193, 7, 0.3);
            overflow: hidden;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.5);
        }

        .header {
            background: linear-gradient(45deg, #ff8c00, #ffc107);
            padding: 30px 20px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .header::before {
            content: 'üç∫';
            position: absolute;
            top: -20px;
            right: -20px;
            font-size: 80px;
            opacity: 0.1;
            animation: float 3s ease-in-out infinite;
        }

        .header::after {
            content: 'üç∫';
            position: absolute;
            bottom: -20px;
            left: -20px;
            font-size: 60px;
            opacity: 0.1;
            animation: float 3s ease-in-out infinite reverse;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }

        .header h1 {
            font-family: 'Cinzel Decorative', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            font-size: 2.2em;
            color: #1a1a1a;
            font-weight: 900;
            letter-spacing: 1px;
            text-shadow: 0 2px 0 #ffd480, 0 4px 0 #ffb84d, 0 6px 10px rgba(0,0,0,0.35);
            margin-bottom: 5px;
        }

        .subtitle {
            color: #2c1810;
            font-size: 1em;
            font-weight: 500;
        }

        .menu-content {
            padding: 0 20px 20px;
        }

        .category {
            margin: 25px 0;
            animation: slideIn 0.6s ease-out;
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .category-title {
            font-size: 1.4em;
            font-weight: bold;
            margin-bottom: 15px;
            padding: 12px 15px;
            background: linear-gradient(45deg, #333, #444);
            border-radius: 12px;
            border-left: 4px solid #ffc107;
            position: relative;
            overflow: hidden;
        }

        .category-title::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(45deg, transparent 40%, rgba(255, 193, 7, 0.1) 50%, transparent 60%);
            animation: shimmer 2s infinite;
        }

        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        .featured-category {
            background: radial-gradient(120% 120% at 50% 0%, #ffd15a 0%, #ff8c00 40%, #ff7a00 70%, #cc6a00 100%) !important;
            color: #1a1a1a !important;
            border-left: 4px solid #1a1a1a !important;
            box-shadow: 0 12px 28px rgba(255, 140, 0, 0.4), inset 0 0 0 1px rgba(0,0,0,0.2);
            transform: scale(1.03);
            font-size: 1.7em !important;
            text-align: center;
            position: relative;
            letter-spacing: 0.5px;
            text-transform: uppercase;
        }

        .featured-category::before {
            content: '–ü–ò–í–ù–´–ï –¢–ê–†–ï–õ–ö–ò';
            position: absolute;
            top: -12px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 0.38em;
            background: #1a1a1a;
            color: #ffc107;
            padding: 4px 10px;
            border-radius: 999px;
            letter-spacing: 1.2px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.35);
        }

        .menu-item {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            padding: 12px 0;
            border-bottom: 1px solid rgba(255, 193, 7, 0.2);
            transition: all 0.3s ease;
        }

        .menu-item:hover {
            background: rgba(255, 193, 7, 0.1);
            border-radius: 8px;
            padding-left: 10px;
            padding-right: 10px;
        }

        .menu-item:last-child {
            border-bottom: none;
        }

        .item-info {
            flex: 1;
            margin-right: 15px;
        }

        .item-name {
            font-weight: 600;
            font-size: 1.1em;
            color: #ffc107;
            margin-bottom: 3px;
        }

        .item-description {
            font-size: 0.85em;
            color: #cccccc;
            line-height: 1.4;
        }

        .item-price {
            font-weight: bold;
            font-size: 1.2em;
            color: #ff8c00;
            white-space: nowrap;
            background: rgba(255, 140, 0, 0.1);
            padding: 4px 8px;
            border-radius: 6px;
            border: 1px solid rgba(255, 140, 0, 0.3);
        }

        .beer-icon {
            display: inline-block;
            animation: bounce 2s infinite;
        }
        .brand {
            font-family: 'Cinzel Decorative', cursive;
            background: linear-gradient(90deg, #7efaff 0%, #5bd4ff 35%, #7e8cff 65%, #ff6bd6 100%);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            text-shadow: 0 0 8px rgba(126,250,255,0.35), 0 0 18px rgba(123,140,255,0.25);
            filter: drop-shadow(0 2px 0 rgba(0,0,0,0.15));
        }

        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
            40% { transform: translateY(-5px); }
            60% { transform: translateY(-3px); }
        }

        .footer {
            text-align: center;
            padding: 20px;
            background: rgba(0, 0, 0, 0.5);
            font-size: 0.9em;
            color: #888;
        }

        .wifi-code {
            background: rgba(255, 193, 7, 0.1);
            border-radius: 8px;
            padding: 10px;
            margin-top: 10px;
            border: 1px dashed #ffc107;
        }
        /* --- Added: interactive styles for cart and modals --- */
        .menu-item { cursor: pointer; }
        .cart-sticky {
            position: fixed;
            right: 20px;
            bottom: 20px;
            z-index: 1000;
        }
        .cart-button {
            background: linear-gradient(45deg, #ff8c00, #ffc107);
            color: #1a1a1a;
            border: none;
            padding: 12px 16px;
            border-radius: 14px;
            font-weight: 700;
            box-shadow: 0 10px 20px rgba(0,0,0,0.3);
            cursor: pointer;
            display: flex;
            gap: 10px;
            align-items: center;
        }
        .cart-button small { color: #3b2a00; font-weight: 600; }
        .modal-backdrop {
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.6);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1100;
            padding: 16px;
        }
        .modal-backdrop.show { display: flex; }
        .modal {
            width: 100%;
            max-width: 420px;
            background: rgba(0,0,0,0.9);
            border: 1px solid rgba(255,193,7,0.3);
            border-radius: 16px;
            padding: 16px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.5);
        }
        .modal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
        .modal-title { font-weight: 700; font-size: 1.2em; color: #ffc107; }
        .icon-button { background: transparent; border: none; color: #ffc107; font-size: 1.4em; cursor: pointer; }
        .cart-items { max-height: 300px; overflow-y: auto; border-top: 1px solid rgba(255,193,7,0.2); border-bottom: 1px solid rgba(255,193,7,0.2); }
        .cart-row { display: grid; grid-template-columns: 1fr auto auto auto; gap: 10px; align-items: center; padding: 10px 0; border-bottom: 1px dashed rgba(255,193,7,0.2); }
        .cart-row:last-child { border-bottom: none; }
        .qty-controls { display: flex; gap: 8px; align-items: center; }
        .qty-btn { background: rgba(255,193,7,0.1); border: 1px solid rgba(255,193,7,0.4); color: #ffc107; width: 28px; height: 28px; border-radius: 6px; cursor: pointer; }
        .remove-btn { background: transparent; border: none; color: #ff6b6b; cursor: pointer; font-size: 0.95em; }
        .cart-summary { display: flex; justify-content: space-between; align-items: center; padding-top: 10px; }
        .primary-btn { background: linear-gradient(45deg, #ff8c00, #ffc107); color: #1a1a1a; border: none; padding: 10px 14px; border-radius: 10px; font-weight: 700; cursor: pointer; }
        .secondary-btn { background: rgba(255,193,7,0.1); color: #ffc107; border: 1px solid rgba(255,193,7,0.4); padding: 10px 14px; border-radius: 10px; cursor: pointer; }
        .muted { color: #bbb; font-size: 0.9em; }
        .confirm-body { display: grid; gap: 10px; }
        .table-input { width: 100%; padding: 10px; border-radius: 10px; border: 1px solid rgba(255,193,7,0.4); background: rgba(255,193,7,0.05); color: #fff; }
        .helper { font-size: 0.85em; color: #aaa; }
        .success { color: #27d17f; font-weight: 700; }
        .error { color: #ff6b6b; font-weight: 700; }
        /* --- end added styles --- */
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1><span class="beer-icon">üç∫</span> <span class="brand">Globus Music Hall</span></h1>
            <div class="subtitle">–ö–æ–Ω—Ü–µ—Ä—Ç–Ω—ã–π –∑–∞–ª</div>
        </div>

        <div class="menu-content">
            <!-- –°–∞–ª–∞—Ç—ã -->
            <div class="category">
                <div class="category-title">ü•ó –°–∞–ª–∞—Ç—ã</div>
                <div class="menu-item">
                    <div class="item-info">
                        <div class="item-name">–¶–µ–∑–∞—Ä—å —Å –∫—É—Ä–∏—Ü–µ–π</div>
                        <div class="item-description">–õ–∏—Å—Ç—å—è —Ä–æ–º–∞–Ω–æ, –∫—É—Ä–∏—Ü–∞ –≥—Ä–∏–ª—å, –ø–∞—Ä–º–µ–∑–∞–Ω, —Å–æ—É—Å —Ü–µ–∑–∞—Ä—å</div>
                    </div>
                    <div class="item-price">450‚ÇΩ</div>
                </div>
                <div class="menu-item">
                    <div class="item-info">
                        <div class="item-name">–ü–∏–≤–Ω–æ–π —Å–∞–ª–∞—Ç</div>
                        <div class="item-description">–ú–∏–∫—Å —Å–∞–ª–∞—Ç–æ–≤, –±–µ–∫–æ–Ω, –∫—Ä—É—Ç–æ–Ω—ã, –ø–∏–≤–Ω–∞—è –∑–∞–ø—Ä–∞–≤–∫–∞</div>
                    </div>
                    <div class="item-price">390‚ÇΩ</div>
                </div>
            </div>

            <!-- –ì–æ—Ä—è—á–∏–µ –∑–∞–∫—É—Å–∫–∏ -->
            <div class="category">
                <div class="category-title">üî• –ì–æ—Ä—è—á–∏–µ –∑–∞–∫—É—Å–∫–∏</div>
                <div class="menu-item">
                    <div class="item-info">
                        <div class="item-name">–ö—É—Ä–∏–Ω—ã–µ –∫—Ä—ã–ª—å—è BBQ</div>
                        <div class="item-description">8 —à—Ç. —Å —Å–æ—É—Å–æ–º –±–∞—Ä–±–µ–∫—é –∏ —Å–µ–ª—å–¥–µ—Ä–µ–µ–º</div>
                    </div>
                    <div class="item-price">520‚ÇΩ</div>
                </div>
                <div class="menu-item">
                    <div class="item-info">
                        <div class="item-name">–°—ã—Ä–Ω—ã–µ –ø–∞–ª–æ—á–∫–∏</div>
                        <div class="item-description">–ú–æ—Ü–∞—Ä–µ–ª–ª–∞ –≤ –ø–∞–Ω–∏—Ä–æ–≤–∫–µ, —Å–æ—É—Å –º–∞—Ä–∏–Ω–∞—Ä–∞</div>
                    </div>
                    <div class="item-price">380‚ÇΩ</div>
                </div>
                <div class="menu-item">
                    <div class="item-info">
                        <div class="item-name">–ö–æ–ª—å—Ü–∞ –∫–∞–ª—å–º–∞—Ä–∞</div>
                        <div class="item-description">–í —Ö—Ä—É—Å—Ç—è—â–µ–π –ø–∞–Ω–∏—Ä–æ–≤–∫–µ —Å —á–µ—Å–Ω–æ—á–Ω—ã–º —Å–æ—É—Å–æ–º</div>
                    </div>
                    <div class="item-price">460‚ÇΩ</div>
                </div>
            </div>

            <!-- –ü–∏–≤–Ω—ã–µ —Ç–∞—Ä–µ–ª–∫–∏ - Featured -->
            <div class="category">
                <div class="category-title featured-category">üç∫ –ü–∏–≤–Ω—ã–µ —Ç–∞—Ä–µ–ª–∫–∏</div>
                <div class="menu-item">
                    <div class="item-info">
                        <div class="item-name">–ú–µ–≥–∞ —Ç–∞—Ä–µ–ª–∫–∞</div>
                        <div class="item-description">–ö–æ–ª–±–∞—Å–∫–∏, —Ä–µ–±—Ä—ã—à–∫–∏, –∫—Ä—ã–ª—å—è, —Å—ã—Ä—ã, —Å–æ–ª–µ–Ω—å—è</div>
                    </div>
                    <div class="item-price">1290‚ÇΩ</div>
                </div>
                <div class="menu-item">
                    <div class="item-info">
                        <div class="item-name">–ë–∞–≤–∞—Ä—Å–∫–∞—è —Ç–∞—Ä–µ–ª–∫–∞</div>
                        <div class="item-description">–ö–æ–ª–±–∞—Å–∫–∏, –∫–≤–∞—à–µ–Ω–∞—è –∫–∞–ø—É—Å—Ç–∞, –∫–∞—Ä—Ç–æ—Ñ–µ–ª—å</div>
                    </div>
                    <div class="item-price">890‚ÇΩ</div>
                </div>
                <div class="menu-item">
                    <div class="item-info">
                        <div class="item-name">–°—ã—Ä–Ω–∞—è —Ç–∞—Ä–µ–ª–∫–∞</div>
                        <div class="item-description">5 –≤–∏–¥–æ–≤ —Å—ã—Ä–∞, –æ—Ä–µ—Ö–∏, –≤–∏–Ω–æ–≥—Ä–∞–¥, –∫—Ä–µ–∫–µ—Ä—ã</div>
                    </div>
                    <div class="item-price">720‚ÇΩ</div>
                </div>
                <div class="menu-item">
                    <div class="item-info">
                        <div class="item-name">–ú—è—Å–Ω–∞—è —Ç–∞—Ä–µ–ª–∫–∞</div>
                        <div class="item-description">–ê—Å—Å–æ—Ä—Ç–∏ –∫–æ–ª–±–∞—Å, –∫–æ–ø—á–µ–Ω–æ—Å—Ç–∏, –≥–æ—Ä—á–∏—Ü–∞</div>
                    </div>
                    <div class="item-price">950‚ÇΩ</div>
                </div>
            </div>

            <!-- –ë—É—Ä–≥–µ—Ä—ã -->
            <div class="category">
                <div class="category-title">üçî –ë—É—Ä–≥–µ—Ä—ã</div>
                <div class="menu-item">
                    <div class="item-info">
                        <div class="item-name">–•–æ–ø –ë—É—Ä–≥–µ—Ä</div>
                        <div class="item-description">–ì–æ–≤—è–¥–∏–Ω–∞, —á–µ–¥–¥–µ—Ä, –±–µ–∫–æ–Ω, –ø–∏–≤–Ω–æ–π —Å–æ—É—Å</div>
                    </div>
                    <div class="item-price">650‚ÇΩ</div>
                </div>
                <div class="menu-item">
                    <div class="item-info">
                        <div class="item-name">–ß–∏–∫–µ–Ω –ë—É—Ä–≥–µ—Ä</div>
                        <div class="item-description">–ö—É—Ä–∏–Ω–∞—è –≥—Ä—É–¥–∫–∞, –º–æ—Ü–∞—Ä–µ–ª–ª–∞, —Ç–æ–º–∞—Ç</div>
                    </div>
                    <div class="item-price">580‚ÇΩ</div>
                </div>
            </div>

            <!-- –ü–∏—Ü—Ü–∞ -->
            <div class="category">
                <div class="category-title">üçï –ü–∏—Ü—Ü–∞</div>
                <div class="menu-item">
                    <div class="item-info">
                        <div class="item-name">–ü–µ–ø–ø–µ—Ä–æ–Ω–∏</div>
                        <div class="item-description">–¢–æ–º–∞—Ç–Ω—ã–π —Å–æ—É—Å, –º–æ—Ü–∞—Ä–µ–ª–ª–∞, –ø–µ–ø–ø–µ—Ä–æ–Ω–∏</div>
                    </div>
                    <div class="item-price">690‚ÇΩ</div>
                </div>
                <div class="menu-item">
                    <div class="item-info">
                        <div class="item-name">–ú—è—Å–Ω–∞—è</div>
                        <div class="item-description">4 –≤–∏–¥–∞ –º—è—Å–∞, —Ç–æ–º–∞—Ç–Ω—ã–π —Å–æ—É—Å, —Å—ã—Ä—ã</div>
                    </div>
                    <div class="item-price">790‚ÇΩ</div>
                </div>
            </div>

            <!-- –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ -->
            <div class="category">
                <div class="category-title">‚ûï –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ</div>
                <div class="menu-item">
                    <div class="item-info">
                        <div class="item-name">–°–æ—É—Å—ã</div>
                        <div class="item-description">BBQ, –ß–µ—Å–Ω–æ—á–Ω—ã–π, –û—Å—Ç—Ä—ã–π, –°—ã—Ä–Ω—ã–π</div>
                    </div>
                    <div class="item-price">80‚ÇΩ</div>
                </div>
                <div class="menu-item">
                    <div class="item-info">
                        <div class="item-name">–ö–∞—Ä—Ç–æ—Ñ–µ–ª—å —Ñ—Ä–∏</div>
                        <div class="item-description">–•—Ä—É—Å—Ç—è—â–∏–π –∫–∞—Ä—Ç–æ—Ñ–µ–ª—å —Å —Å–ø–µ—Ü–∏—è–º–∏</div>
                    </div>
                    <div class="item-price">250‚ÇΩ</div>
                </div>
                <div class="menu-item">
                    <div class="item-info">
                        <div class="item-name">–õ—É–∫–æ–≤—ã–µ –∫–æ–ª—å—Ü–∞</div>
                        <div class="item-description">–í –ø–∏–≤–Ω–æ–º –∫–ª—è—Ä–µ</div>
                    </div>
                    <div class="item-price">290‚ÇΩ</div>
                </div>
            </div>
        </div>

        <div class="footer">
            <div>–í—Ä–µ–º—è —Ä–∞–±–æ—Ç—ã: 12:00 - 02:00</div>
            <div class="wifi-code">
                üì∂ WiFi: HopHouse | –ü–∞—Ä–æ–ª—å: beer2025
            </div>
        </div>
    </div>

    <!-- Cart sticky button -->
    <div class="cart-sticky" id="cartSticky" style="display:none;">
        <button class="cart-button" id="openCartBtn">üõí –ö–æ—Ä–∑–∏–Ω–∞ <small id="cartSummary">(0) ‚Ä¢ 0‚ÇΩ</small></button>
    </div>

    <!-- Cart Modal -->
    <div class="modal-backdrop" id="cartModal">
        <div class="modal">
            <div class="modal-header">
                <div class="modal-title">–ö–æ—Ä–∑–∏–Ω–∞</div>
                <button class="icon-button" id="closeCartBtn">‚úñ</button>
            </div>
            <div class="muted">–ù–∞–∂–º–∏—Ç–µ –Ω–∞ –±–ª—é–¥–æ –≤ –º–µ–Ω—é, —á—Ç–æ–±—ã –¥–æ–±–∞–≤–∏—Ç—å –≤ –∫–æ—Ä–∑–∏–Ω—É</div>
            <div class="cart-items" id="cartItems"></div>
            <div class="cart-summary">
                <div><strong>–ò—Ç–æ–≥–æ:</strong> <span id="cartTotal">0‚ÇΩ</span></div>
                <div style="display:flex; gap:10px;">
                    <button class="secondary-btn" id="clearCartBtn">–û—á–∏—Å—Ç–∏—Ç—å</button>
                    <button class="primary-btn" id="checkoutBtn">–û—Ñ–æ—Ä–º–∏—Ç—å</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Confirm Modal -->
    <div class="modal-backdrop" id="confirmModal">
        <div class="modal">
            <div class="modal-header">
                <div class="modal-title">–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –∑–∞–∫–∞–∑–∞</div>
                <button class="icon-button" id="closeConfirmBtn">‚úñ</button>
            </div>
            <div class="confirm-body">
                <div class="muted">–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–∑–∏—Ü–∏–∏ –∏ —É–∫–∞–∂–∏—Ç–µ –Ω–æ–º–µ—Ä —Å—Ç–æ–ª–∏–∫–∞ (1‚Äì100).</div>
                <div id="confirmList" class="muted"></div>
                <label>
                    –ù–æ–º–µ—Ä —Å—Ç–æ–ª–∏–∫–∞:
                    <input class="table-input" type="number" id="tableInput" min="1" max="100" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: 12" />
                </label>
                <div class="helper">–î–æ—Å—Ç—É–ø–Ω—ã —Ç–æ–ª—å–∫–æ —á–∏—Å–ª–∞ –æ—Ç 1 –¥–æ 100</div>
                <div style="display:flex; gap:10px; justify-content:flex-end;">
                    <button class="secondary-btn" id="backToCartBtn">–ù–∞–∑–∞–¥</button>
                    <button class="primary-btn" id="confirmOrderBtn">–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å</button>
                </div>
                <div id="confirmStatus" class="muted"></div>
            </div>
        </div>
    </div>

    <script>
    (function(){
        const params = new URLSearchParams(location.search);
        const apiFromQuery = params.get('api');
        if (apiFromQuery) {
            try { new URL(apiFromQuery); localStorage.setItem('apiBase', apiFromQuery); } catch(e) {}
        }
        const storedApi = localStorage.getItem('apiBase') || '';
        const API_BASE = (location.hostname === 'localhost' || location.hostname === '127.0.0.1') ? '' : (storedApi || '');
        window.__API_BASE = API_BASE;
        const formatCurrency = (n) => `${n.toLocaleString('ru-RU')}‚ÇΩ`;
        const cart = new Map(); // key: name, value: { name, price, qty }

        const els = {
            cartSticky: document.getElementById('cartSticky'),
            cartSummary: document.getElementById('cartSummary'),
            openCartBtn: document.getElementById('openCartBtn'),
            cartModal: document.getElementById('cartModal'),
            closeCartBtn: document.getElementById('closeCartBtn'),
            cartItems: document.getElementById('cartItems'),
            cartTotal: document.getElementById('cartTotal'),
            clearCartBtn: document.getElementById('clearCartBtn'),
            checkoutBtn: document.getElementById('checkoutBtn'),
            confirmModal: document.getElementById('confirmModal'),
            closeConfirmBtn: document.getElementById('closeConfirmBtn'),
            backToCartBtn: document.getElementById('backToCartBtn'),
            confirmOrderBtn: document.getElementById('confirmOrderBtn'),
            confirmList: document.getElementById('confirmList'),
            tableInput: document.getElementById('tableInput'),
            confirmStatus: document.getElementById('confirmStatus'),
        };

        function parsePrice(text){
            const digits = (text || '').replace(/[^0-9]/g,'');
            return Number.parseInt(digits || '0', 10);
        }

        function addToCart(name, price){
            const key = name.trim();
            const existing = cart.get(key);
            if (existing){
                existing.qty += 1;
            } else {
                cart.set(key, { name: key, price, qty: 1 });
            }
            updateSticky();
        }

        function decFromCart(name){
            const item = cart.get(name);
            if (!item) return;
            item.qty -= 1;
            if (item.qty <= 0) cart.delete(name);
            updateSticky();
        }

        function removeFromCart(name){
            cart.delete(name);
            updateSticky();
        }

        function getTotals(){
            let totalQty = 0; let totalSum = 0;
            for (const { price, qty } of cart.values()){
                totalQty += qty;
                totalSum += price * qty;
            }
            return { totalQty, totalSum };
        }

        function updateSticky(){
            const { totalQty, totalSum } = getTotals();
            if (totalQty > 0){
                els.cartSticky.style.display = 'block';
                els.cartSummary.textContent = `(${totalQty}) ‚Ä¢ ${formatCurrency(totalSum)}`;
            } else {
                els.cartSticky.style.display = 'none';
            }
            renderCart();
        }

        function renderCart(){
            const { totalSum } = getTotals();
            els.cartTotal.textContent = formatCurrency(totalSum);
            const rows = [];
            for (const item of cart.values()){
                const lineTotal = item.price * item.qty;
                rows.push(
                    `<div class="cart-row" data-name="${item.name}">
                        <div>
                            <div style="color:#ffc107; font-weight:600;">${item.name}</div>
                            <div class="muted">${formatCurrency(item.price)} √ó ${item.qty} = ${formatCurrency(lineTotal)}</div>
                        </div>
                        <div class="qty-controls">
                            <button class="qty-btn" data-action="dec">‚àí</button>
                            <span>${item.qty}</span>
                            <button class="qty-btn" data-action="inc">+</button>
                        </div>
                        <div style="white-space:nowrap;">${formatCurrency(lineTotal)}</div>
                        <button class="remove-btn" data-action="remove">—É–¥–∞–ª–∏—Ç—å</button>
                    </div>`
                );
            }
            els.cartItems.innerHTML = rows.join('') || '<div class="muted" style="padding:12px;">–ö–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞</div>';
        }

        function openModal(backdrop){ backdrop.classList.add('show'); }
        function closeModal(backdrop){ backdrop.classList.remove('show'); }

        // Bind cart modal open/close
        els.openCartBtn.addEventListener('click', () => openModal(els.cartModal));
        els.closeCartBtn.addEventListener('click', () => closeModal(els.cartModal));
        els.cartModal.addEventListener('click', (e)=>{ if (e.target === els.cartModal) closeModal(els.cartModal); });

        els.clearCartBtn.addEventListener('click', () => { cart.clear(); updateSticky(); });

        // Cart items actions (inc/dec/remove)
        els.cartItems.addEventListener('click', (e)=>{
            const btn = e.target.closest('button');
            if (!btn) return;
            const row = btn.closest('.cart-row');
            const name = row?.dataset?.name;
            if (!name) return;
            const action = btn.dataset.action;
            if (action === 'inc') addToCart(name, cart.get(name)?.price || 0);
            if (action === 'dec') decFromCart(name);
            if (action === 'remove') removeFromCart(name);
        });

        // Checkout -> open confirm
        els.checkoutBtn.addEventListener('click', ()=>{
            const { totalQty } = getTotals();
            if (totalQty === 0){
                alert('–ö–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞');
                return;
            }
            const lines = [];
            for (const item of cart.values()){
                lines.push(`‚Ä¢ ${item.name} ‚Äî ${formatCurrency(item.price)} √ó ${item.qty} = ${formatCurrency(item.price * item.qty)}`);
            }
            const total = formatCurrency(getTotals().totalSum);
            els.confirmList.innerHTML = `<div>${lines.join('<br>')}</div><div style="margin-top:8px;"><strong>–ò—Ç–æ–≥–æ: ${total}</strong></div>`;
            els.tableInput.value = '';
            els.confirmStatus.textContent = '';
            closeModal(els.cartModal);
            openModal(els.confirmModal);
        });

        // Confirm modal actions
        els.closeConfirmBtn.addEventListener('click', ()=> closeModal(els.confirmModal));
        els.backToCartBtn.addEventListener('click', ()=> { closeModal(els.confirmModal); openModal(els.cartModal); });

        els.confirmOrderBtn.addEventListener('click', async ()=>{
            const tableNum = Number.parseInt(els.tableInput.value || '');
            if (!Number.isInteger(tableNum) || tableNum < 1 || tableNum > 100){
                els.confirmStatus.textContent = '–í–≤–µ–¥–∏—Ç–µ –Ω–æ–º–µ—Ä —Å—Ç–æ–ª–∏–∫–∞ –æ—Ç 1 –¥–æ 100';
                els.confirmStatus.className = 'error';
                return;
            }
            const items = Array.from(cart.values()).map(({name, price, qty})=>({ name, price, quantity: qty }));
            const total = getTotals().totalSum;
            els.confirmOrderBtn.disabled = true;
            els.confirmOrderBtn.textContent = '–û—Ç–ø—Ä–∞–≤–∫–∞...';
            els.confirmStatus.textContent = '';
            try {
                const resp = await fetch((API_BASE || '') + '/api/order', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ items, total, table: tableNum })
                });
                if (!resp.ok){
                    let extra = '';
                    if (resp.status === 405 || resp.status === 404) {
                        extra = ' –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∞–¥—Ä–µ—Å API. –ï—Å–ª–∏ –æ—Ç–∫—Ä—ã—Ç–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–∞ GitHub Pages, –¥–æ–±–∞–≤—å—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä ?api=URL_–í–ê–®–ï–ì–û_–°–ï–†–í–ï–†–ê.';
                    }
                    throw new Error(`–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞: ${resp.status}.${extra}`);
                }
                const data = await resp.json();
                if (data && data.ok){
                    const orderId = data.orderId || '‚Äî';
                    els.confirmStatus.innerHTML = `<span class="success">–ó–∞–∫–∞–∑ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω!</span> –ù–æ–º–µ—Ä –∑–∞–∫–∞–∑–∞: <strong>#${orderId}</strong>`;
                    cart.clear();
                    updateSticky();
                } else {
                    throw new Error(data?.message || '–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –∑–∞–∫–∞–∑');
                }
            } catch (err){
                els.confirmStatus.textContent = `–ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –∑–∞–∫–∞–∑. ${err.message || err}`;
                els.confirmStatus.className = 'error';
            } finally {
                els.confirmOrderBtn.disabled = false;
                els.confirmOrderBtn.textContent = '–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å';
            }
        });

        // Make all menu items clickable
        document.querySelectorAll('.menu-item').forEach((el)=>{
            el.addEventListener('click', ()=>{
                const name = el.querySelector('.item-name')?.textContent?.trim();
                const priceText = el.querySelector('.item-price')?.textContent;
                const price = parsePrice(priceText);
                if (!name || !price) return;
                addToCart(name, price);
            });
        });

        // Initial
        updateSticky();
    })();
    </script>
</body>
</html>
